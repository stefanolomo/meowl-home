<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="assets/positions/south.png">
    <title>Meowl's Garden - Fixed Horizon</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            overflow: hidden;
            font-family: 'Segoe UI', sans-serif;
            background-color: #fdf6f0;
        }

        .garden {
            width: 100vw;
            height: 100vh;
            background: linear-gradient(180deg, #fdf6f0 0%, #fce4ec 30%, #f8bbd9 60%);
            position: relative;
            overflow: hidden;
        }

        /* --- EL SUELO (GRASS) --- */
        .grass {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 45vh; /* Altura fija relativa al alto de pantalla */
            background: linear-gradient(180deg, #a5d6a7 0%, #81c784 50%, #66bb6a 100%);
            border-radius: 50% 50% 0 0 / 15% 15% 0 0;
            z-index: 1;
        }

        /* --- SOL Y NUBES --- */
        .sun {
            position: absolute;
            top: 40px;
            right: 80px;
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, #fff9c4 0%, #ffeb3b 50%, #ffc107 100%);
            border-radius: 50%;
            box-shadow: 0 0 60px #fff59d, 0 0 100px #ffee58;
            z-index: 0;
        }

        .cloud {
            position: absolute;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50px;
            z-index: 0;
        }

        /* --- CASA --- */
        .house {
            position: absolute;
            bottom: 38vh; /* Anclada al horizonte del pasto */
            z-index: 2;
        }

        .house-body {
            width: 140px;
            height: 100px;
            background: linear-gradient(135deg, #ffe4ec 0%, #ffcdd2 100%);
            border-radius: 8px;
            position: relative;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .house-roof {
            width: 0;
            height: 0;
            border-left: 85px solid transparent;
            border-right: 85px solid transparent;
            border-bottom: 70px solid #f8bbd9;
            position: absolute;
            top: -70px;
            left: -15px;
        }

        .house-door {
            width: 35px;
            height: 55px;
            background: linear-gradient(135deg, #b69a7d 0%, #a1887f 100%);
            border-radius: 5px 5px 0 0;
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
        }

        .house-window {
            width: 30px;
            height: 30px;
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border: 3px solid #f8bbd9;
            border-radius: 5px;
            position: absolute;
            top: 20px;
        }
        .house-window.left { left: 15px; }
        .house-window.right { right: 15px; }

        /* --- ÁRBOLES Y FLORES --- */
        .tree {
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .tree-trunk {
            background: linear-gradient(90deg, #6d4c41 0%, #a1887f 50%, #6d4c41 100%);
            border-radius: 8px 8px 0 0;
            position: relative;
        }

        .foliage-cluster {
            position: absolute;
            border-radius: 50%;
            opacity: 0.9;
        }

        .flower {
            position: absolute;
        }

        .petal {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            position: absolute;
        }

        .flower-center {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            position: absolute;
            z-index: 2;
        }

        /* --- PERSONAJE --- */
        .meowl {
            position: absolute;
            z-index: 50; /* El z-index se ajustará por JS según su posición Y */
            transition: left 0.1s ease-out, top 0.1s ease-out;
        }

        .meowl img {
            width: 200px;
            height: auto;
            image-rendering: pixelated;
        }

        .instructions {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.7);
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            color: #7b6b5d;
            z-index: 100;
            backdrop-filter: blur(5px);
        }
    </style>
</head>
<body>
    <div class="garden" id="garden">
        <div class="sun"></div>
        <div class="grass"></div>
        <div class="meowl" id="meowl">
            <img src="assets/positions/south.png" alt="Meowl" id="meowl-sprite">
        </div>
        <div class="instructions">
            Usa las flechas o WASD para moverte por el mundito
        </div>
    </div>

    <script>
        const garden = document.getElementById('garden');
        const meowl = document.getElementById('meowl');
        const meowlSprite = document.getElementById('meowl-sprite');

        const treeColors = [
            { light: '#c8e6c9', mid: '#a5d6a7', dark: '#81c784' },
            { light: '#dcedc8', mid: '#c5e1a5', dark: '#aed581' },
            { light: '#f8bbd9', mid: '#f48fb1', dark: '#ec407a' }
        ];

        const flowerColors = [
            { petals: '#f8bbd9', center: '#fff59d' },
            { petals: '#e1bee7', center: '#ffcc80' },
            { petals: '#b3e5fc', center: '#fff9c4' }
        ];

        // --- GENERADOR DE ÁRBOLES ---
        function createTree(x, bottomVH, size, colors) {
            const tree = document.createElement('div');
            tree.className = 'tree';
            tree.style.left = x + 'px';
            tree.style.bottom = bottomVH + 'vh';
            tree.style.zIndex = Math.floor(100 - bottomVH); // Los de más abajo están al frente

            const trunk = document.createElement('div');
            trunk.className = 'tree-trunk';
            trunk.style.height = (size * 0.8) + 'px';
            trunk.style.width = (size * 0.2) + 'px';
            tree.appendChild(trunk);

            const foliage = document.createElement('div');
            foliage.style.position = 'absolute';
            foliage.style.bottom = (size * 0.6) + 'px';

            const clusters = [
                { x: 0, y: 0, s: 1, c: colors.dark },
                { x: -0.4, y: 0.2, s: 0.8, c: colors.mid },
                { x: 0.4, y: 0.2, s: 0.8, c: colors.mid },
                { x: 0, y: 0.5, s: 0.7, c: colors.light }
            ];

            clusters.forEach(cls => {
                const c = document.createElement('div');
                c.className = 'foliage-cluster';
                c.style.width = (size * cls.s) + 'px';
                c.style.height = (size * cls.s) + 'px';
                c.style.background = cls.c;
                c.style.left = (cls.x * size - (size * cls.s)/2) + 'px';
                c.style.bottom = (cls.y * size) + 'px';
                foliage.appendChild(c);
            });

            tree.appendChild(foliage);
            garden.appendChild(tree);
        }

        // --- GENERADOR DE FLORES ---
        function createFlower(x, bottomVH, color) {
            const flower = document.createElement('div');
            flower.className = 'flower';
            flower.style.left = x + 'px';
            flower.style.bottom = bottomVH + 'vh';
            flower.style.zIndex = Math.floor(100 - bottomVH);

            const petals = document.createElement('div');
            for(let i=0; i<5; i++) {
                const p = document.createElement('div');
                p.className = 'petal';
                p.style.background = color.petals;
                p.style.transform = `rotate(${i*72}deg) translate(8px)`;
                petals.appendChild(p);
            }
            const center = document.createElement('div');
            center.className = 'flower-center';
            center.style.background = color.center;
            center.style.left = '-6px'; center.style.top = '-6px';
            
            flower.appendChild(petals);
            flower.appendChild(center);
            garden.appendChild(flower);
        }

        // --- INICIALIZAR ESCENA ---
        function initScene() {
            // Casa
            const house = document.createElement('div');
            house.className = 'house';
            house.innerHTML = '<div class="house-body"><div class="house-roof"></div><div class="house-door"></div><div class="house-window left"></div><div class="house-window right"></div></div>';
            house.style.left = '15vw';
            garden.appendChild(house);

            // Árboles (posicionados por VH desde el fondo para que no se muevan)
            createTree(window.innerWidth * 0.7, 35, 180, treeColors[0]);
            createTree(window.innerWidth * 0.85, 20, 150, treeColors[1]);
            createTree(window.innerWidth * 0.4, 30, 160, treeColors[2]);

            // Flores
            for(let i=0; i<25; i++) {
                createFlower(Math.random() * window.innerWidth, Math.random() * 38, flowerColors[i%3]);
            }
        }

        // --- LÓGICA DE MOVIMIENTO ---
        let meowlX = window.innerWidth / 2;
        let meowlY = window.innerHeight * 0.7;
        const keys = {};
        let currentDirection = 'south';

        function getDirection(dx, dy) {
            if (dx === 0 && dy === -1) return 'north';
            if (dx === 0 && dy === 1) return 'south';
            if (dx === 1 && dy === 0) return 'east';
            if (dx === -1 && dy === 0) return 'west';
            if (dx === 1 && dy === -1) return 'north-east';
            if (dx === -1 && dy === -1) return 'north-west';
            if (dx === 1 && dy === 1) return 'south-east';
            if (dx === -1 && dy === 1) return 'south-west';
            return null;
        }

        function move() {
            let dx = 0, dy = 0;
            if (keys['ArrowUp'] || keys['w']) dy = -1;
            if (keys['ArrowDown'] || keys['s']) dy = 1;
            if (keys['ArrowLeft'] || keys['a']) dx = -1;
            if (keys['ArrowRight'] || keys['d']) dx = 1;

            if (dx !== 0 || dy !== 0) {
                const speed = 7;
                meowlX += dx * speed;
                meowlY += dy * speed;

                // Límites: No salirse de la pantalla y no subir más allá del horizonte del pasto
                meowlX = Math.max(0, Math.min(window.innerWidth - 200, meowlX));
                meowlY = Math.max(window.innerHeight * 0.55, Math.min(window.innerHeight - 200, meowlY));

                meowl.style.left = meowlX + 'px';
                meowl.style.top = meowlY + 'px';

                const newDirection = getDirection(dx, dy);
                if (newDirection && newDirection !== currentDirection) {
                    currentDirection = newDirection;
                    meowlSprite.src = `assets/positions/${currentDirection}.png`;
                }

                // Profundidad dinámica: Si está más abajo en pantalla, su z-index es mayor
                const currentBottomVH = ((window.innerHeight - meowlY) / window.innerHeight) * 100;
                meowl.style.zIndex = Math.floor(101 - currentBottomVH);
            }
            requestAnimationFrame(move);
        }

        document.addEventListener('keydown', e => keys[e.key] = true);
        document.addEventListener('keyup', e => keys[e.key] = false);

        initScene();
        move();

        window.addEventListener('resize', () => {
            location.reload(); // Recarga para reposicionar assets si cambia mucho la pantalla
        });
    </script>
</body>
</html>
